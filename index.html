<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>QR Code & Link Tools</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <script src="https://unpkg.com/html5-qrcode/minified/html5-qrcode.min.js"></script>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center p-6">

  <h1 class="text-3xl font-bold text-blue-600 mb-6">QR Code & Link Utility Portal</h1>

  <!-- Input Section -->
  <div class="bg-white shadow-lg rounded-2xl p-6 w-full max-w-lg">
    <label class="block mb-2 font-semibold">Enter Link:</label>
    <input id="linkInput" type="text" placeholder="Paste your link here" 
      class="w-full border p-2 rounded mb-4">

    <!-- Color Picker -->
    <label class="block mb-2 font-semibold">QR Color:</label>
    <input id="colorInput" type="color" value="#000000" class="mb-4">

    <!-- Logo Upload -->
    <label class="block mb-2 font-semibold">Upload Logo (Optional):</label>
    <input id="logoInput" type="file" accept="image/*" class="mb-4">

    <!-- Buttons -->
    <div class="flex gap-3 mb-4">
      <button onclick="generateQR()" 
        class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Generate QR</button>
      <button onclick="shortenLink()" 
        class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">Shorten Link</button>
    </div>

    <!-- QR Code Display -->
    <div id="qrcode" class="flex justify-center mb-4"></div>

    <!-- Download Button -->
    <button id="downloadBtn" onclick="downloadQR()" 
      class="hidden bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600">Download QR Code</button>
  </div>

  <!-- QR Scanner Section -->
  <div class="bg-white shadow-lg rounded-2xl p-6 w-full max-w-lg mt-6">
    <h2 class="text-xl font-bold mb-4">Scan QR Code</h2>
    <div id="reader" style="width:100%"></div>
    <p id="scanResult" class="mt-3 text-green-700 font-semibold"></p>
    <button onclick="copyResult()" id="copyBtn" 
      class="hidden mt-3 bg-yellow-500 text-white px-4 py-2 rounded hover:bg-yellow-600">Copy Link</button>
  </div>

<script>
  let qrCode;
  let scannedLink = "";

  function generateQR() {
    const link = document.getElementById("linkInput").value;
    const color = document.getElementById("colorInput").value;
    const logoFile = document.getElementById("logoInput").files[0];
    const qrDiv = document.getElementById("qrcode");
    qrDiv.innerHTML = "";

    if (!link) {
      alert("Please enter a link!");
      return;
    }

    qrCode = new QRCode(qrDiv, {
      text: link,
      width: 200,
      height: 200,
      colorDark: color,
      colorLight: "#ffffff"
    });

    document.getElementById("downloadBtn").classList.remove("hidden");

    // If logo is provided, add in center
    if (logoFile) {
      const reader = new FileReader();
      reader.onload = function (e) {
        const img = new Image();
        img.src = e.target.result;
        img.onload = function () {
          const qrCanvas = qrDiv.querySelector("canvas");
          const ctx = qrCanvas.getContext("2d");
          const logoSize = 50;
          ctx.drawImage(img, (qrCanvas.width - logoSize) / 2, (qrCanvas.height - logoSize) / 2, logoSize, logoSize);
        };
      };
      reader.readAsDataURL(logoFile);
    }
  }

  function downloadQR() {
    const qrCanvas = document.querySelector("#qrcode canvas");
    const link = document.createElement("a");
    link.download = "qrcode.png";
    link.href = qrCanvas.toDataURL();
    link.click();
  }

  function shortenLink() {
    const longUrl = document.getElementById("linkInput").value;
    if (!longUrl) {
      alert("Enter a link to shorten");
      return;
    }

    fetch(`https://tinyurl.com/api-create.php?url=${encodeURIComponent(longUrl)}`)
      .then(res => res.text())
      .then(shortUrl => {
        document.getElementById("linkInput").value = shortUrl;
        alert("Shortened URL: " + shortUrl);
      });
  }

  // QR Scanner
  function onScanSuccess(decodedText) {
    scannedLink = decodedText;
    document.getElementById("scanResult").innerText = "Scanned Link: " + decodedText;
    document.getElementById("copyBtn").classList.remove("hidden");
  }

  const html5QrCode = new Html5Qrcode("reader");
  Html5Qrcode.getCameras().then(cameras => {
    if (cameras.length > 0) {
      html5QrCode.start({ facingMode: "environment" }, { fps: 10, qrbox: 250 }, onScanSuccess);
    }
  });

  function copyResult() {
    navigator.clipboard.writeText(scannedLink);
    alert("Link copied: " + scannedLink);
  }
</script>
</body>
</html>
